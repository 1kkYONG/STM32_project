# 📡 USART 小專案心得整理

這次完成 USART 的文字模式與 HEX 模式測試後，我整理出幾個在實作過程中特別重要的要點，無論是哪一種資料格式，核心概念其實都一致。

---

## 1. 先規劃好資料格式（封包格式）

在撰寫程式前，最好先決定通訊資料要長什麼樣子，例如：

- 起始字元（例如：`@`、`0xAA`）
- 結束字元（例如：`\n`、`\r\n`、`0x55`）
- 是否加入長度欄位
- 是否需要固定欄位或固定順序

越早決定格式，後續接收邏輯越不容易混亂。

---

## 2. 決定是否採用固定長度資料

### ✔ 固定長度  
最簡單，只要收到固定 Byte 數就能解析。

### ✔ 非固定長度  
需要依靠：
- 起始字元
- 結束字元
- 長度欄位
- 旗標（flags）

來判斷封包是否完整。

---

## 3. 接收端建議使用旗標管理流程

常用旗標例如：

- `frame_start_flag`（是否遇到起始字元）
- `frame_end_flag`（是否遇到結尾字元）
- `rx_index`（寫入 buffer 的位置）

旗標可以協助程式追蹤「目前接收狀態」，避免資料覆蓋或無法判斷封包是否完成。

---

## 4. 複雜流程可用狀態機（State Machine）設計

在處理資料包時，流程可能包含：

1. 等待起始字元  
2. 接收內容  
3. 判斷長度  
4. 檢查結尾字元  
5. 驗證封包完整性  

若使用大量 `if-else`，邏輯容易混亂。改用簡單的狀態機（如 `IDLE → RECV → CHECK → DONE`）會讓程式更清楚、穩定，也更容易除錯。

---

## 5. 文字模式需要記得加入字串結尾字元 \0

在 C 語言中，字串（char[]）必須以 '\0'（NULL 字元）作為結尾，不然標準字串函式（例如 strcmp()、strlen()、printf()）都會出問題。
